# AIèœè°±çŸ¥è¯†å›¾è°±ç”Ÿæˆå™¨
## åŸºäºKimiå¤§æ¨¡å‹çš„æ™ºèƒ½èœè°±è§£æç³»ç»Ÿ

### ğŸŒŸ æ–°åŠŸèƒ½ç‰¹æ€§

- **ğŸ¤– AIæ™ºèƒ½è§£æ**: ä½¿ç”¨Kimiå¤§æ¨¡å‹å‡†ç¡®æå–èœè°±ä¿¡æ¯
- **ğŸ“Š ç»“æ„åŒ–è¾“å‡º**: è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–çš„çŸ¥è¯†å›¾è°±æ•°æ®
- **ğŸ”„ æ‰¹é‡å¤„ç†**: æ”¯æŒå¤§è§„æ¨¡èœè°±ç›®å½•çš„æ‰¹é‡è½¬æ¢
- **ğŸ’¾ å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒNeo4jå’ŒCSVä¸¤ç§è¾“å‡ºæ ¼å¼
- **ğŸ¯ é«˜ç²¾åº¦**: AIæ¨¡å‹ç¡®ä¿é£Ÿæåˆ†ç±»ã€æ­¥éª¤è§£æçš„å‡†ç¡®æ€§
- **ğŸ“ æ™ºèƒ½ç›®å½•è¯†åˆ«**: è‡ªåŠ¨æ‰«ædishes/ç›®å½•ï¼Œæ ¹æ®å­ç›®å½•åæ¨æ–­åˆ†ç±»
- **âš¡ ä¼˜åŒ–å¤„ç†**: å‡å°‘AIåˆ†ç±»å·¥ä½œï¼Œæé«˜å¤„ç†æ•ˆç‡å’Œå‡†ç¡®æ€§

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 2. é…ç½®APIå¯†é’¥

æ–¹æ³•ä¸€ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
```bash
export KIMI_API_KEY="your_api_key_here"
```

æ–¹æ³•äºŒï¼šç¼–è¾‘config.json
```json
{
  "kimi": {
    "api_key": "your_api_key_here"
  }
}
```

#### 3. æµ‹è¯•AIè§£æåŠŸèƒ½

```bash
python run_ai_agent.py test
```

#### 4. æ‰¹é‡å¤„ç†èœè°±

```bash
# å¤„ç†HowToCooké¡¹ç›®ï¼ˆä¼šè‡ªåŠ¨æ‰«ædishes/ç›®å½•ï¼‰
python run_ai_agent.py /path/to/HowToCook-master

# å¤„ç†å…¶ä»–èœè°±ç›®å½•
python run_ai_agent.py /path/to/your/recipes
```

### ğŸ“ é¡¹ç›®ç»“æ„

```
cook-rag-example/
â”œâ”€â”€ recipe_ai_agent.py         # AIè§£ææ ¸å¿ƒå¼•æ“
â”œâ”€â”€ run_ai_agent.py            # ç®€åŒ–è¿è¡Œè„šæœ¬
â”œâ”€â”€ batch_manager.py           # æ‰¹æ¬¡ç®¡ç†å·¥å…·
â”œâ”€â”€ amount_normalizer.py       # ç”¨é‡æ ‡å‡†åŒ–å·¥å…·
â”œâ”€â”€ config.json                # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â””â”€â”€ ai_output/                 # AIè¾“å‡ºç›®å½•
    â”œâ”€â”€ nodes.csv              # Neo4jèŠ‚ç‚¹æ•°æ®
    â”œâ”€â”€ relationships.csv      # Neo4jå…³ç³»æ•°æ®
    â””â”€â”€ neo4j_import.cypher    # Neo4jå¯¼å…¥è„šæœ¬
```

### ğŸ“ æ™ºèƒ½ç›®å½•å¤„ç†

#### è‡ªåŠ¨åˆ†ç±»è¯†åˆ«

ç³»ç»Ÿä¼šæ™ºèƒ½è¯†åˆ«HowToCooké¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š

- **ä¸“é—¨æ‰«æ**: åªå¤„ç† `dishes/` ç›®å½•ä¸‹çš„èœè°±æ–‡ä»¶
- **è‡ªåŠ¨åˆ†ç±»**: æ ¹æ®å­ç›®å½•åè‡ªåŠ¨æ¨æ–­èœè°±åˆ†ç±»
- **æ’é™¤æ— å…³æ–‡ä»¶**: è‡ªåŠ¨è·³è¿‡ `template/`ã€`.github/` ç­‰ç›®å½•

#### ç›®å½•åˆ†ç±»æ˜ å°„

```
vegetable_dish/ â†’ ç´ èœ
meat_dish/     â†’ è¤èœ  
aquatic/       â†’ æ°´äº§
breakfast/     â†’ æ—©é¤
staple/        â†’ ä¸»é£Ÿ
soup/          â†’ æ±¤ç±»
dessert/       â†’ ç”œå“
drink/         â†’ é¥®æ–™
condiment/     â†’ è°ƒæ–™
semi-finished/ â†’ åŠæˆå“
```

#### å¤„ç†ä¼˜åŒ–

- **å‡å°‘AIå·¥ä½œé‡**: åˆ†ç±»ä¿¡æ¯ç›´æ¥ä»ç›®å½•ç»“æ„è·å–ï¼Œæ— éœ€AIæ¨ç†
- **æé«˜å‡†ç¡®æ€§**: é¿å…AIåˆ†ç±»é”™è¯¯ï¼Œç¡®ä¿åˆ†ç±»ä¸€è‡´æ€§
- **åŠ å¿«å¤„ç†é€Ÿåº¦**: å‡å°‘APIè°ƒç”¨å¤æ‚åº¦å’Œå¤„ç†æ—¶é—´

### ğŸ¤– AIè§£æèƒ½åŠ›

#### æ™ºèƒ½ä¿¡æ¯æå–

AIç³»ç»Ÿèƒ½å¤Ÿä»Markdownèœè°±ä¸­å‡†ç¡®æå–ï¼š

1. **åŸºæœ¬ä¿¡æ¯**
   - èœè°±åç§°
   - éš¾åº¦ç­‰çº§ï¼ˆ1-5æ˜Ÿï¼‰
   - èœè°±åˆ†ç±»ï¼ˆç´ èœ/è¤èœ/æ°´äº§ç­‰ï¼‰
   - èœç³»å½’å±ï¼ˆå·èœ/ç²¤èœç­‰ï¼‰

2. **é£Ÿæä¿¡æ¯** 
   - é£Ÿæåç§°å’Œåˆ†ç±»
   - ç”¨é‡å’Œå•ä½
   - ä¸»è¦é£Ÿæè¯†åˆ«

3. **çƒ¹é¥ªæ­¥éª¤**
   - æ­¥éª¤æè¿°å’Œé¡ºåº
   - ä½¿ç”¨çš„çƒ¹é¥ªæ–¹æ³•
   - éœ€è¦çš„å·¥å…·
   - æ—¶é—´ä¼°è®¡

4. **é¢å¤–ä¿¡æ¯**
   - å‡†å¤‡æ—¶é—´/çƒ¹é¥ªæ—¶é—´
   - ä¾›åº”äººæ•°
   - è¥å…»ä¿¡æ¯ï¼ˆå½“å¯ç”¨æ—¶ï¼‰
   - ç›¸å…³æ ‡ç­¾

#### ç¤ºä¾‹ï¼šAIè§£æç»“æœ

è¾“å…¥èœè°±ï¼š
```markdown
# çº¢çƒ§èŒ„å­çš„åšæ³•
é¢„ä¼°çƒ¹é¥ªéš¾åº¦ï¼šâ˜…â˜…â˜…â˜…
## å¿…å¤‡åŸæ–™å’Œå·¥å…·
- é’èŒ„å­
- å¤§è’œ
- é…±æ²¹
- é¢ç²‰
```

AIè§£æè¾“å‡ºï¼š
```json
{
  "name": "çº¢çƒ§èŒ„å­",
  "difficulty": 4,
  "category": "ç´ èœ",
  "ingredients": [
    {
      "name": "é’èŒ„å­",
      "category": "è”¬èœ",
      "is_main": true
    },
    {
      "name": "å¤§è’œ", 
      "category": "è”¬èœ",
      "is_main": false
    }
  ]
}
```

### ğŸ“Š çŸ¥è¯†å›¾è°±ç»“æ„

#### Neo4jæ•°æ®æ¨¡å‹

**èŠ‚ç‚¹ç±»å‹**:
- `Recipe`: èœè°±
- `Ingredient`: é£Ÿæ  
- `CookingStep`: çƒ¹é¥ªæ­¥éª¤

**å…³ç³»ç±»å‹**:
- `has_ingredient`: èœè°±åŒ…å«é£Ÿæ
- `has_step`: èœè°±åŒ…å«æ­¥éª¤
- `belongs_to_category`: å±äºåˆ†ç±»
- `has_difficulty`: å…·æœ‰éš¾åº¦

#### ç¤ºä¾‹æŸ¥è¯¢

```cypher
// æŸ¥æ‰¾æ‰€æœ‰åŒ…å«èŒ„å­çš„èœè°±
MATCH (recipe:Concept)-[:has_ingredient]->(ing:Concept)
WHERE ing.name CONTAINS "èŒ„å­"
RETURN recipe.name, recipe.difficulty

// æŸ¥æ‰¾å››æ˜Ÿéš¾åº¦çš„ç´ èœ
MATCH (recipe:Concept)-[:belongs_to_category]->(cat:Concept)
WHERE cat.name = "ç´ èœ" AND recipe.difficulty = 4
RETURN recipe.name

// æ¨èåŸºäºç°æœ‰é£Ÿæçš„èœè°±
MATCH (recipe:Concept)-[:has_ingredient]->(ing:Concept)
WHERE ing.name IN ["èŒ„å­", "å¤§è’œ", "é…±æ²¹"]
WITH recipe, count(ing) as matches
WHERE matches >= 2
RETURN recipe.name, matches
ORDER BY matches DESC
```

### âš™ï¸ é…ç½®é€‰é¡¹

#### config.jsonè¯¦ç»†é…ç½®

```json
{
  "deepseek": {
    "api_key": "your_api_key",
    "base_url": "https://api.deepseek.com",
    "model": "deepseek-chat",
    "max_retries": 3,
    "timeout": 30
  },
  "processing": {
    "batch_size": 10,
    "delay_between_requests": 1,
    "max_concurrent_requests": 5
  },
  "output": {
    "format": "neo4j",
    "directory": "./ai_output",
    "include_nutrition": true,
    "include_tags": true
  }
}
```

### ï¿½ï¸ è¾…åŠ©å·¥å…·

#### æ‰¹æ¬¡ç®¡ç†å·¥å…· (batch_manager.py)

ç”¨äºç®¡ç†åˆ†æ‰¹å¤„ç†çš„è¿›åº¦å’Œæ•°æ®ï¼š

```bash
# æŸ¥çœ‹å¤„ç†çŠ¶æ€
python batch_manager.py status

# ç»§ç»­ä¸­æ–­çš„å¤„ç†
python batch_manager.py continue /path/to/recipes

# åˆå¹¶æ‰¹æ¬¡æ•°æ®
python batch_manager.py merge

# æ¸…ç†è¿›åº¦æ–‡ä»¶
python batch_manager.py clean-progress

# æ¸…ç†æ‰¹æ¬¡æ•°æ®
python batch_manager.py clean-batches

# æ˜¾ç¤ºæ‰¹æ¬¡è¯¦æƒ…
python batch_manager.py details
```

#### ç”¨é‡æ ‡å‡†åŒ–å·¥å…· (amount_normalizer.py)

æä¾›é£Ÿæç”¨é‡çš„æ ‡å‡†åŒ–å¤„ç†ï¼š

```python
from amount_normalizer import AmountNormalizer

normalizer = AmountNormalizer()

# æ ‡å‡†åŒ–ç”¨é‡
normalized, estimated = normalizer.normalize_amount("é€‚é‡", "æ¯«å‡")
# è¿”å›: ("é€‚é‡", 10.0)

# è·å–å¯æ¯”è¾ƒçš„æ•°å€¼
comparable = normalizer.get_comparable_value("ä¸€æŠŠ", "")
# è¿”å›: 50.0

# æ ¼å¼åŒ–æ˜¾ç¤º
display = normalizer.format_for_display("2-3ä¸ª", "")
# è¿”å›: "2-3ä¸ª"
```

### ï¿½ğŸ”§ é«˜çº§ç”¨æ³•

#### 1. è‡ªå®šä¹‰åˆ†ç±»æ˜ å°„

```python
# åœ¨recipe_ai_agent.pyä¸­ä¿®æ”¹
category_mapping = {
    "ç´ èœ": "710000000",
    "è¤èœ": "720000000", 
    "è‡ªå®šä¹‰åˆ†ç±»": "999000000"
}
```

#### 2. æ‰©å±•AIæç¤ºè¯

```python
# ä¿®æ”¹extract_recipe_infoæ–¹æ³•ä¸­çš„prompt
prompt = f"""
è¯·åˆ†æèœè°±å¹¶æŒ‰ä»¥ä¸‹æ ¼å¼æå–ä¿¡æ¯ï¼š
- æ·»åŠ æ‚¨çš„è‡ªå®šä¹‰è¦æ±‚
- ç‰¹æ®Šçš„åˆ†ç±»è§„åˆ™
- é¢å¤–çš„è¥å…»ä¿¡æ¯è¦æ±‚
"""
```

#### 3. æ‰¹é‡å¤„ç†ä¼˜åŒ–

```python
# è°ƒæ•´å¤„ç†å‚æ•°
builder = RecipeKnowledgeGraphBuilder(ai_agent)
builder.batch_size = 20  # å¢åŠ æ‰¹æ¬¡å¤§å°
builder.delay = 0.5      # å‡å°‘è¯·æ±‚é—´éš”
```

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

#### APIè°ƒç”¨ä¼˜åŒ–

1. **åˆç†çš„è¯·æ±‚é¢‘ç‡**: é»˜è®¤æ¯ç§’1æ¬¡è¯·æ±‚ï¼Œé¿å…APIé™åˆ¶
2. **é”™è¯¯é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
3. **æ‰¹é‡å¤„ç†**: åˆ†æ‰¹å¤„ç†å¤§é‡èœè°±æ–‡ä»¶

#### å†…å­˜ä¼˜åŒ–

1. **æµå¼å¤„ç†**: é€ä¸ªå¤„ç†èœè°±æ–‡ä»¶ï¼Œé¿å…å†…å­˜æº¢å‡º
2. **å®šæœŸæ¸…ç†**: å¤„ç†å®ŒæˆååŠæ—¶é‡Šæ”¾å†…å­˜
3. **è¿›åº¦ç›‘æ§**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦

### ğŸ” æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

1. **APIå¯†é’¥é”™è¯¯**
   ```
   é”™è¯¯: APIè°ƒç”¨å¤±è´¥: 401
   è§£å†³: æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
   ```

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```
   é”™è¯¯: APIè°ƒç”¨è¶…æ—¶
   è§£å†³: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–å¢åŠ timeoutè®¾ç½®
   ```

3. **JSONè§£æé”™è¯¯**
   ```
   é”™è¯¯: JSONè§£æé”™è¯¯
   è§£å†³: AIå“åº”æ ¼å¼å¼‚å¸¸ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨å¤‡ç”¨è§£ææ–¹æ³•
   ```

4. **èœè°±æ ¼å¼é—®é¢˜**
   ```
   é”™è¯¯: æ— æ³•æå–èœè°±ä¿¡æ¯
   è§£å†³: æ£€æŸ¥Markdownæ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚
   ```

#### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export DEBUG=true
python run_ai_agent.py /path/to/recipes

# æµ‹è¯•å•ä¸ªèœè°±
python run_ai_agent.py test
```

### ğŸ“‹ ä½¿ç”¨åœºæ™¯

#### 1. èœè°±ç½‘ç«™æ„å»º
- è‡ªåŠ¨åˆ†ç±»å’Œæ ‡ç­¾
- æ™ºèƒ½æ¨èç³»ç»Ÿ
- è¥å…»åˆ†æ

#### 2. çƒ¹é¥ªåº”ç”¨å¼€å‘
- é£Ÿæè¯†åˆ«
- æ­¥éª¤æŒ‡å¯¼
- å·¥å…·æ¨è

#### 3. è¥å…»ç ”ç©¶
- é£Ÿæè¥å…»åˆ†æ
- è†³é£Ÿæ­é…ç ”ç©¶
- å¥åº·é¥®é£Ÿæ¨è

#### 4. é¤é¥®ä¸šåŠ¡
- èœå•ä¼˜åŒ–
- æˆæœ¬åˆ†æ
- å®¢æˆ·åå¥½åˆ†æ

### ğŸŒ æ‰©å±•å¼€å‘

#### æ·»åŠ æ–°çš„AIæ¨¡å‹

```python
class CustomAIAgent(DeepSeekRecipeAgent):
    def __init__(self, api_key, model_name="custom-model"):
        super().__init__(api_key)
        self.model_name = model_name
    
    def call_custom_api(self, messages):
        # å®ç°æ‚¨çš„è‡ªå®šä¹‰AIè°ƒç”¨é€»è¾‘
        pass
```

#### æ”¯æŒæ–°çš„è¾“å‡ºæ ¼å¼

```python
def export_to_custom_format(self, output_dir):
    """å¯¼å‡ºä¸ºè‡ªå®šä¹‰æ ¼å¼"""
    # å®ç°æ‚¨çš„å¯¼å‡ºé€»è¾‘
    pass
```

### ğŸ“Š æ•°æ®è´¨é‡ä¿è¯

#### AIè§£æå‡†ç¡®æ€§

- **å¤šè½®éªŒè¯**: AIæå–åè¿›è¡Œæ ¼å¼éªŒè¯
- **å¤‡ç”¨è§£æ**: AIå¤±è´¥æ—¶ä½¿ç”¨è§„åˆ™è§£æ
- **äººå·¥å®¡æ ¸**: æä¾›æ•°æ®å®¡æ ¸æ¥å£

#### æ•°æ®ä¸€è‡´æ€§

- **æ ‡å‡†åŒ–åˆ†ç±»**: ç»Ÿä¸€çš„é£Ÿæå’Œèœè°±åˆ†ç±»
- **å…³ç³»éªŒè¯**: ç¡®ä¿å›¾è°±å…³ç³»çš„é€»è¾‘ä¸€è‡´æ€§
- **é‡å¤æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç†é‡å¤æ•°æ®

---

**äº«å—AIé©±åŠ¨çš„èœè°±çŸ¥è¯†å›¾è°±æ„å»ºä½“éªŒï¼** ğŸ‰ 

ç°åœ¨ä½ å¯ä»¥å®‰å…¨åœ°è¿›è¡Œæ‰¹é‡å¤„ç†äº†ï¼ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¤„ç†æ•´ä¸ªHowToCooké¡¹ç›®ï¼š

```bash
python run_ai_agent.py HowToCook-master
```

ç³»ç»Ÿä¼šï¼š
1. ğŸ¯ ä¸“é—¨æ‰«æ `HowToCook-master/dishes/` ç›®å½•
2. ğŸ“ æ ¹æ®å­ç›®å½•è‡ªåŠ¨è¯†åˆ«åˆ†ç±» (vegetable_dishâ†’ç´ èœ, meat_dishâ†’è¤èœç­‰)
3. ğŸš« è‡ªåŠ¨æ’é™¤templateã€.githubç­‰éèœè°±ç›®å½•
4. ğŸ¤– ç”¨AIæ™ºèƒ½è§£ææ¯ä¸ªèœè°±çš„è¯¦ç»†ä¿¡æ¯
5. ğŸ“Š ç”Ÿæˆå®Œæ•´çš„çŸ¥è¯†å›¾è°±æ•°æ®